# Common settings
{
	admin off
	persist_config off
	storage file_system /config
}

# Remove WWW from domain
www.{$HOSTNAME} {
	redir https://{$HOSTNAME}{uri}
}

# Main domain
{$HOSTNAME} {
	root * /app/public
	encode gzip
	php_fastcgi unix//var/run/php-fpm.sock
	file_server

	request_body {
		max_size 100MB
	}

	log {
		output stdout
		format transform `{request>remote_ip} - {request>user_id} [{ts}] "{request>method} {request>uri} {request>proto}" {status} {size} "{request>headers>Referer>[0]}" "{request>headers>User-Agent>[0]}"` {
			time_local
			time_format "02/Jan/2006:15:04:05 -0700"
		}
	}
}
